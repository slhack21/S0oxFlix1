<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S0oxFlix</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root { --bg:#0b0616; --card:#1a0d33; --accent:#6a1b9a; --text:#e0d0ff; --hover:#9c27b0; }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:var(--bg); color:var(--text); font-family:'Segoe UI',Arial,sans-serif; min-height:100vh; }
    header { background:var(--accent); padding:22px; text-align:center; font-size:2rem; font-weight:bold; color:white; }
    .ad-notice { background:#2d1b3a; color:#ccc; text-align:center; padding:10px; font-size:0.9rem; font-weight:500; }
    .search-bar { padding:18px; text-align:center; }
    #search { width:90%; max-width:550px; padding:14px 20px; background:var(--card); color:var(--text); border:none; border-radius:50px; font-size:1.1rem; outline:none; }
    .section { padding:25px 15px; }
    .section h2 { color:var(--accent); margin-bottom:18px; font-size:1.6rem; display:flex; align-items:center; gap:12px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:18px; }
    .card { background:var(--card); border-radius:16px; overflow:hidden; cursor:pointer; transition:0.4s; box-shadow:0 4px 12px rgba(0,0,0,0.3); }
    .card:hover { transform:scale(1.08); box-shadow:0 12px 25px rgba(106,27,154,0.6); }
    .card img { width:100%; height:240px; object-fit:cover; }
    .info { padding:12px; text-align:center; }
    .info h3 { font-size:1rem; margin:6px 0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:white; }
    .info p { font-size:0.85rem; color:#ccc; }
    @media (max-width:600px){ .grid { grid-template-columns:repeat(auto-fill,minmax(130px,1fr)); } }
  </style>
</head>
<body>

  <header><h1>S0oxFlix</h1></header>

  <!-- TEXTE D'AVANT REMIS -->
  <div class="ad-notice">
    Il y aura des pubs, désolé. Ferme juste la page de redirection et reviens ici
  </div>

  <div class="search-bar">
    <input type="text" id="search" placeholder="Rechercher un film..." />
  </div>

  <div class="section">
    <h2>En ce moment</h2>
    <div class="grid" id="nowPlaying">Chargement...</div>
  </div>

  <div class="section">
    <h2>Top Rated</h2>
    <div class="grid" id="topRated">Chargement...</div>
  </div>

  <div class="section">
    <h2>Populaires</h2>
    <div class="grid" id="popular">Chargement...</div>
  </div>

  <script>
    const API_KEY = '6c2b12d2fa62845b21cd9bb35c1959b0';
    let allFilms = [];

    async function fetchMovies(endpoint) {
      const res = await fetch(`https://api.themoviedb.org/3/movie/${endpoint}?api_key=${API_KEY}&language=fr-FR&page=1`);
      const data = await res.json();
      return data.results.slice(0, 12).map(m => ({
        title: m.title,
        year: m.release_date?.split('-')[0] || 'N/A',
        poster: m.poster_path ? `https://image.tmdb.org/t/p/w500${m.poster_path}` : 'https://via.placeholder.com/500x750?text=No+Image',
        tmdb: m.id
      }));
    }

    async function loadSections() {
      const [now, top, pop] = await Promise.all([
        fetchMovies('now_playing'),
        fetchMovies('top_rated'),
        fetchMovies('popular')
      ]);
      allFilms = [...now, ...top, ...pop];
      render('nowPlaying', now);
      render('topRated', top);
      render('popular', pop);
    }

    function render(id, list) {
      const grid = document.getElementById(id);
      grid.innerHTML = '';
      list.forEach(f => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<img src="${f.poster}"><div class="info"><h3>${f.title}</h3><p>${f.year}</p></div>`;
        card.onclick = () => window.open(`movie_details.html?id=${f.tmdb}`, '_blank');
        grid.appendChild(card);
      });
    }

    document.getElementById('search').oninput = () => {
      const q = document.getElementById('search').value.toLowerCase().trim();
      if (!q) return loadSections();
      const filtered = allFilms.filter(f => f.title.toLowerCase().includes(q));
      render('nowPlaying', filtered);
      document.querySelectorAll('.section').forEach((s, i) => s.style.display = i === 0 ? 'block' : 'none');
    };

    loadSections();
  </script>
</body>
</html>
