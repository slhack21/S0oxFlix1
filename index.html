<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S0oxFlix</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root { --bg:#0b0616; --card:#1a0d33; --accent:#6a1b9a; --text:#e0d0ff; --hover:#9c27b0; }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:var(--bg); color:var(--text); font-family:'Segoe UI',Arial,sans-serif; min-height:100vh; overflow-x:hidden; }
    header { background:var(--accent); padding:22px; text-align:center; font-size:2rem; font-weight:bold; color:white; box-shadow:0 4px 15px rgba(106,27,154,0.4); position:relative; z-index:10; }
    .ad-notice { background:#2d1b3a; color:#ccc; text-align:center; padding:10px; font-size:0.9rem; font-weight:500; }
    .search-bar { padding:18px; text-align:center; }
    #search { width:90%; max-width:550px; padding:14px 20px; background:var(--card); color:var(--text); border:none; border-radius:50px; font-size:1.1rem; outline:none; box-shadow:0 4px 12px rgba(0,0,0,0.3); transition:0.3s; }
    #search:focus { box-shadow:0 0 0 3px rgba(106,27,154,0.5); }
    #search::placeholder { color:#aaa; }
    .section { padding:25px 15px; opacity:0; transform:translateY(20px); transition:0.6s; }
    .section.visible { opacity:1; transform:translateY(0); }
    .section h2 { color:var(--accent); margin-bottom:18px; font-size:1.6rem; display:flex; align-items:center; gap:12px; font-weight:600; }
    .section h2 i { color:var(--hover); font-size:1.4rem; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:18px; }
    .card { background:var(--card); border-radius:16px; overflow:hidden; cursor:pointer; transition:0.4s; position:relative; box-shadow:0 4px 12px rgba(0,0,0,0.3); }
    .card:hover { transform:scale(1.08); box-shadow:0 12px 25px rgba(106,27,154,0.6); z-index:2; }
    .card img { width:100%; height:240px; object-fit:cover; transition:0.3s; }
    .card:hover img { filter:brightness(0.8); }
    .info { padding:12px; text-align:center; }
    .info h3 { font-size:1rem; margin:6px 0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:white; font-weight:500; }
    .info p { font-size:0.85rem; color:#ccc; }
    .player-container { margin:25px auto; max-width:1200px; background:var(--card); border-radius:18px; overflow:hidden; box-shadow:0 15px 40px rgba(0,0,0,0.7); display:none; position:relative; }
    .player-container.active { display:block; }
    .player-header { background:var(--accent); color:white; padding:16px 20px; display:flex; justify-content:space-between; align-items:center; font-weight:bold; font-size:1.2rem; }
    .close-player { background:none; border:none; color:white; font-size:2rem; cursor:pointer; transition:0.3s; }
    .close-player:hover { color:#ff5252; }
    iframe { width:100%; height:560px; border:none; display:none; }
    .player-loading { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#aaa; font-size:1.2rem; text-align:center; display:block; z-index:1; }
    .player-loading i { font-size:2rem; color:var(--hover); animation:spin 1s linear infinite; margin-bottom:10px; display:block; }
    @keyframes spin { from { transform:rotate(0deg); } to { transform:rotate(360deg); } }
    .popup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.92); display:none; z-index:1000; align-items:center; justify-content:center; backdrop-filter:blur(5px); }
    .popup.active { display:flex; }
    .popup-content { background:var(--card); padding:40px; border-radius:20px; text-align:center; max-width:450px; box-shadow:0 15px 40px rgba(106,27,154,0.4); transform:scale(0.9); transition:0.3s; }
    .popup.active .popup-content { transform:scale(1); }
    .popup-content h3 { color:var(--accent); margin-bottom:14px; font-size:1.5rem; }
    .popup-content p { margin-bottom:25px; color:#ddd; font-size:1rem; }
    .popup-btn { background:var(--accent); color:white; padding:15px 32px; border:none; border-radius:50px; cursor:pointer; font-size:1.1rem; font-weight:600; transition:0.3s; }
    .popup-btn:hover { background:var(--hover); transform:scale(1.05); }
    .error { text-align:center; color:#f66; padding:50px; font-size:1.2rem; }
    @media (max-width:600px){ 
      iframe{height:320px;} 
      .grid { grid-template-columns:repeat(auto-fill,minmax(130px,1fr)); }
      .popup-content { padding:30px; }
      header { font-size:1.6rem; }
    }
  </style>
</head>
<body>

  <header><h1>S0oxFlix</h1></header>

  <div class="ad-notice">
    Il y aura des pubs, désolé. Ferme juste la page de redirection et reviens ici
  </div>

  <div class="search-bar">
    <input type="text" id="search" placeholder="Rechercher un film..." />
  </div>

  <!-- SECTIONS DYNAMIQUES -->
  <div class="section" id="nowPlayingSection">
    <h2><i class="fas fa-play-circle"></i> En ce moment au cinéma</h2>
    <div class="grid" id="nowPlaying">Chargement...</div>
  </div>

  <div class="section" id="topRatedSection">
    <h2><i class="fas fa-star"></i> Top Rated</h2>
    <div class="grid" id="topRated">Chargement...</div>
  </div>

  <div class="section" id="popularSection">
    <h2><i class="fas fa-fire"></i> Populaires</h2>
    <div class="grid" id="popular">Chargement...</div>
  </div>

  <div class="section" id="upcomingSection">
    <h2><i class="fas fa-calendar-alt"></i> À venir</h2>
    <div class="grid" id="upcoming">Chargement...</div>
  </div>

  <!-- PLAYER -->
  <div class="player-container" id="playerContainer">
    <div class="player-header">
      <span id="currentTitle"></span>
      <button class="close-player" onclick="closePlayer()">×</button>
    </div>
    <div class="player-loading" id="loadingMsg">
      <i class="fas fa-spinner"></i><br>
      Chargement du film...<br><small>2-3 secondes</small>
    </div>
    <iframe id="player" allowfullscreen allow="autoplay; fullscreen; encrypted-media" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
  </div>

  <!-- POPUPS ADS -->
  <div class="popup" id="ad1">
    <div class="popup-content">
      <h3>ATTENTION ADS!</h3>
      <p>Merci de ton soutien !</p>
      <button class="popup-btn" onclick="showAd2()">Continuer</button>
    </div>
  </div>

  <div class="popup" id="ad2">
    <div class="popup-content">
      <h3>Merci !</h3>
      <p>Le film démarre...</p>
      <button class="popup-btn" onclick="playFromAd()">Regarder</button>
    </div>
  </div>

  <script>
    // === REMPLACE PAR TA CLÉ TMDB ICI ===
    const API_KEY = '6c2b12d2fa62845b21cd9bb35c1959b0'; // ← OBLIGATOIRE
    // === FIN CLÉ ===

    let allFilms = [];
    let currentFilm = null;

    // Vérification clé
    if (!API_KEY || API_KEY === '6c2b12d2fa62845b21cd9bb35c1959b0') {
      document.body.innerHTML = '<div class="error"><h2>Erreur</h2><p>Ajoute ta clé TMDB dans le code !</p><p>Va sur <a href="https://www.themoviedb.org/settings/api" target="_blank" style="color:var(--accent);">themoviedb.org</a> → API → Copie ta clé v3</p></div>';
      throw new Error('Clé TMDB manquante');
    }

    // Fetch TMDB
    async function fetchMovies(endpoint) {
      try {
        const res = await fetch(`https://api.themoviedb.org/3/movie/${endpoint}?api_key=${API_KEY}&language=fr-FR&page=1`);
        if (!res.ok) throw new Error('TMDB API error');
        const data = await res.json();
        return data.results.slice(0, 12).map(m => ({
          title: m.title,
          year: m.release_date ? m.release_date.split('-')[0] : 'N/A',
          poster: m.poster_path ? `https://image.tmdb.org/t/p/w500${m.poster_path}` : 'https://via.placeholder.com/500x750?text=No+Image',
          tmdb: m.id,
          embed: `https://vidsrc.me/embed/movie/${m.id}`
        }));
      } catch (err) {
        console.error('TMDB Error:', err);
        return [];
      }
    }

    // Chargement des sections
    async function loadSections() {
      const sections = [
        { id: 'nowPlaying', endpoint: 'now_playing' },
        { id: 'topRated', endpoint: 'top_rated' },
        { id: 'popular', endpoint: 'popular' },
        { id: 'upcoming', endpoint: 'upcoming' }
      ];

      for (const sec of sections) {
        document.getElementById(sec.id).innerHTML = '<p style="color:#aaa;grid-column:1/-1;">Chargement...</p>';
      }

      for (const sec of sections) {
        const films = await fetchMovies(sec.endpoint);
        allFilms = allFilms.concat(films);
        renderGrid(films, sec.id);
        // Animation d'apparition
        setTimeout(() => {
          document.getElementById(sec.id + 'Section').classList.add('visible');
        }, 100);
      }
    }

    function renderGrid(list, containerId) {
      const grid = document.getElementById(containerId);
      grid.innerHTML = '';
      if (list.length === 0) {
        grid.innerHTML = '<p style="color:#aaa;grid-column:1/-1;">Aucun film</p>';
        return;
      }
      list.forEach(f => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${f.poster}" onerror="this.src='https://via.placeholder.com/500x750?text=No+Image'" loading="lazy">
          <div class="info"><h3>${f.title}</h3><p>${f.year}</p></div>
        `;
        card.onclick = () => {
          currentFilm = f;
          document.getElementById('ad1').classList.add('active');
        };
        grid.appendChild(card);
      });
    }

    // Recherche
    document.getElementById('search').oninput = () => {
      const q = document.getElementById('search').value.toLowerCase().trim();
      const sections = document.querySelectorAll('.section');
      
      if (q === '') {
        sections.forEach(s => s.style.display = 'block');
        loadSections();
        return;
      }

      const filtered = allFilms.filter(f => f.title.toLowerCase().includes(q));
      renderGrid(filtered, 'nowPlaying');
      sections.forEach((s, i) => s.style.display = i === 0 ? 'block' : 'none');
      document.querySelector('#nowPlayingSection h2').innerHTML = `<i class="fas fa-search"></i> Résultats pour "${q}" (${filtered.length})`;
    };

    // Pubs
    function showAd2() {
      document.getElementById('ad1').classList.remove('active');
      const ad = document.createElement('script');
      ad.src = '//pl27976969.effectivegatecpm.com/f1/f2/7c/f1f27c6bc9906eca8322aec126ded56b.js';
      document.head.appendChild(ad);
      setTimeout(() => {
        if (document.head.contains(ad)) document.head.removeChild(ad);
        document.getElementById('ad2').classList.add('active');
      }, 5000);
    }

    function playFromAd() {
      document.getElementById('ad2').classList.remove('active');
      play(currentFilm);
    }

    function play(f) {
      document.getElementById('currentTitle').textContent = f.title;
      const iframe = document.getElementById('player');
      const loading = document.getElementById('loadingMsg');
      document.getElementById('playerContainer').classList.add('active');
      loading.style.display = 'block';
      iframe.style.display = 'none';

      iframe.src = f.embed + '?t=' + Date.now() + '&autoplay=1';

      iframe.onload = () => {
        loading.style.display = 'none';
        iframe.style.display = 'block';
      };
    }

    function closePlayer() {
      document.getElementById('playerContainer').classList.remove('active');
      document.getElementById('player').src = '';
    }

    // Démarrage
    window.onload = loadSections;
  </script>
</body>
</html>
