<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S0oxFlix</title>
  <style>
    :root { --bg:#0f0a1a; --card:#1a0d33; --accent:#6a1b9a; --text:#e0d0ff; }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:var(--bg); color:var(--text); font-family:Arial; min-height:100vh; }
    header { background:var(--accent); padding:20px; text-align:center; font-size:1.8rem; font-weight:bold; color:white; }
    .ad-notice { background:#2d1b3a; color:#ccc; text-align:center; padding:8px; font-size:0.85rem; }
    .search-bar { padding:15px; text-align:center; }
    #search { width:90%; max-width:500px; padding:12px; background:var(--card); color:var(--text); border:none; border-radius:30px; font-size:1rem; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:15px; padding:20px; }
    .card { background:var(--card); border-radius:12px; overflow:hidden; cursor:pointer; transition:0.3s; }
    .card:hover { transform:scale(1.05); box-shadow:0 5px 15px rgba(106,27,154,0.4); }
    .card img { width:100%; height:200px; object-fit:cover; }
    .info { padding:10px; text-align:center; }
    .info h3 { font-size:0.95rem; margin:5px 0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .info p { font-size:0.8rem; color:#bbb; }
    .player-container { margin:20px auto; max-width:1000px; background:var(--card); border-radius:16px; overflow:hidden; box-shadow:0 8px 25px rgba(0,0,0,0.5); display:none; position:relative; }
    .player-container.active { display:block; }
    .player-header { background:var(--accent); color:white; padding:12px 15px; display:flex; justify-content:space-between; align-items:center; font-weight:bold; }
    .close-player { background:none; border:none; color:white; font-size:1.5rem; cursor:pointer; }
    iframe { width:100%; height:500px; border:none; display:none; }
    .player-loading { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#aaa; font-size:1rem; text-align:center; display:block; z-index:1; }
    @media (max-width:600px){ iframe{height:300px;} }
  </style>
</head>
<body>

  <header><h1>S0oxFlix</h1></header>

  <div class="ad-notice">
    Il y aura des pubs, d√©sol√©. Ferme juste la page de redirection et reviens ici üôè
  </div>

  <div class="search-bar">
    <input type="text" id="search" placeholder="Rechercher un film..." />
  </div>

  <div class="grid" id="films">Chargement...</div>

  <div class="player-container" id="playerContainer">
    <div class="player-header">
      <span id="currentTitle"></span>
      <button class="close-player" onclick="closePlayer()">X</button>
    </div>
    <div class="player-loading" id="loadingMsg">Chargement...<br><small>2-3s</small></div>
    <iframe id="player" allowfullscreen allow="autoplay; fullscreen; encrypted-media" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
  </div>

  <script>
    let films = [];
    let currentFilm = null;

    // CHARGEMENT AVEC ANTI-CACHE
    fetch('films.json?v=' + Date.now())
      .then(r => r.json())
      .then(data => {
        films = data;
        render(films);
      })
      .catch(err => {
        console.error("Erreur JSON:", err);
        document.getElementById('films').innerHTML = '<p style="text-align:center;color:#aaa;padding:40px;">Erreur : films.json introuvable</p>';
      });

    function render(list) {
      const grid = document.getElementById('films');
      grid.innerHTML = '';
      if (!list || list.length === 0) return;
      list.forEach(f => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${f.poster}" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
          <div class="info"><h3>${f.title}</h3><p>${f.year}</p></div>
        `;
        card.onclick = () => play(f);
        grid.appendChild(card);
      });
    }

    function play(f) {
      document.getElementById('currentTitle').textContent = f.title;
      const iframe = document.getElementById('player');
      const loading = document.getElementById('loadingMsg');
      document.getElementById('playerContainer').classList.add('active');
      loading.style.display = 'block';
      iframe.style.display = 'none';

      // FORCE RELOAD + ANTI-CACHE
      iframe.src = f.embed + '?t=' + Date.now();

      iframe.onload = () => {
        loading.style.display = 'none';
        iframe.style.display = 'block';
      };

      // 1 PUB DISCR√àTE
      const ad = document.createElement('script');
      ad.src = '//pl27976969.effectivegatecpm.com/f1/f2/7c/f1f27c6bc9906eca8322aec126ded56b.js';
      document.head.appendChild(ad);
      setTimeout(() => document.head.removeChild(ad), 8000);
    }

    function closePlayer() {
      document.getElementById('playerContainer').classList.remove('active');
      document.getElementById('player').src = '';
    }

    // RECHERCHE
    document.getElementById('search').oninput = () => {
      const q = document.getElementById('search').value.toLowerCase().trim();
      const filtered = films.filter(f => f.title.toLowerCase().includes(q));
      render(filtered);
    };
  </script>
</body>
</html>
