<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>S0oxFlix</title>
  <style>
    :root {--bg:#0f0a1a;--p:#6a0dad;--a:#9d4edd;--t:#e0d4ff;--c:#1a1033;}
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:var(--bg);color:var(--t);font-family:Arial;overflow-x:hidden;}
    header{background:var(--c);padding:1rem;position:sticky;top:0;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,0.5);}
    .logo{font-size:2rem;color:var(--a);font-weight:bold;text-align:center;}
    .search input{width:90%;max-width:600px;margin:1rem auto;display:block;padding:1rem;border-radius:50px;background:var(--bg);color:var(--t);border:1px solid var(--a);outline:none;}
    .search input::placeholder{color:#999;}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem;padding:1rem;}
    .card{background:var(--c);border-radius:12px;overflow:hidden;cursor:pointer;transition:transform 0.2s ease;box-shadow:0 4px 8px rgba(0,0,0,0.3);}
    .card:hover{transform:scale(1.05);}
    .card img{width:100%;height:220px;object-fit:cover;}
    .card .title{padding:0.5rem;font-size:0.9rem;text-align:center;}
    .player{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:999;justify-content:center;align-items:center;padding:2rem;}
    .player.active{display:flex;}
    .player iframe{width:90%;max-width:1000px;height:70vh;border:none;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.5);background:#000;}
    .close{position:absolute;top:20px;right:20px;background:var(--p);color:#fff;border:none;width:50px;height:50px;border-radius:50%;font-size:1.5rem;cursor:pointer;transition:background 0.2s;}
    .close:hover{background:var(--a);}
    .loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);border:4px solid var(--c);border-top:4px solid var(--a);border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;}
    .error-msg{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#ff6b6b;text-align:center;font-size:1.1rem;display:none;}
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    @media(max-width:768px){.grid{grid-template-columns:1fr 1fr;gap:0.5rem;padding:0.5rem;}.player iframe{width:100%;height:60vh;}}
  </style>
</head>
<body>

<header><div class="logo">S0oxFlix</div></header>

<input type="text" placeholder="Rechercher..." oninput="search(this.value)" class="search">

<div class="grid" id="grid">
  <!-- Films avec IMDB ID -->
  <div class="card" data-imdb="tt32820897" data-title="Demon Slayer: La Forteresse infinie">
    <img src="https://image.tmdb.org/t/p/w500/infinity-castle-poster.jpg" onerror="this.src='https://via.placeholder.com/150x220?text=Demon+Slayer'">
    <div class="title">Demon Slayer: La Forteresse infinie</div>
  </div>
  <div class="card" data-imdb="tt13069986" data-title="À contre-sens 3">
    <img src="https://image.tmdb.org/t/p/w500/after-we-fell-poster.jpg" onerror="this.src='https://via.placeholder.com/150x220?text=À+contre-sens+3'">
    <div class="title">À contre-sens 3</div>
  </div>
  <div class="card" data-imdb="tt29644189" data-title="Black Phone 2">
    <img src="https://image.tmdb.org/t/p/w500/black-phone-2-poster.jpg" onerror="this.src='https://via.placeholder.com/150x220?text=Black+Phone+2'">
    <div class="title">Black Phone 2</div>
  </div>
  <div class="card" data-imdb="tt0816692" data-title="Interstellar">
    <img src="https://image.tmdb.org/t/p/w500/interstellar-poster.jpg" onerror="this.src='https://via.placeholder.com/150x220?text=Interstellar'">
    <div class="title">Interstellar</div>
  </div>
  <div class="card" data-imdb="tt24046542" data-title="Chien 51">
    <img src="https://via.placeholder.com/150x220?text=Chien+51">
    <div class="title">Chien 51</div>
  </div>
  <div class="card" data-imdb="tt1517268" data-title="Scooby-Doo et Krypto!">
    <img src="https://image.tmdb.org/t/p/w500/scooby-doo-krypto-poster.jpg" onerror="this.src='https://via.placeholder.com/150x220?text=Scooby'">
    <div class="title">Scooby-Doo et Krypto!</div>
  </div>
  <!-- Ajoute d'autres ici -->
</div>

<div class="player" id="player">
  <button class="close" onclick="closePlayer()">X</button>
  <div class="loader" id="loader"></div>
  <div class="error-msg" id="error-msg">Lecture impossible. Réessayez plus tard.</div>
  <iframe id="frame" loading="lazy"></iframe>
</div>

<script>
  const providers = [
    imdb => `https://vidsrc.to/embed/movie/${imdb}`,
    imdb => `https://vidsrc.me/embed/movie?tmdb=${imdb}`,
    imdb => `https://www.2embed.cc/embed/movie/${imdb}`
  ];

  function play(imdb, title) {
    const player = document.getElementById('player');
    const frame = document.getElementById('frame');
    const loader = document.getElementById('loader');
    const errorMsg = document.getElementById('error-msg');
    let index = 0;
    let timeout;

    function tryNext() {
      if (index >= providers.length) {
        loader.style.display = 'none';
        errorMsg.style.display = 'block';
        return;
      }

      const url = providers[index](imdb);
      frame.src = url;
      loader.style.display = 'block';
      errorMsg.style.display = 'none';

      clearTimeout(timeout);
      timeout = setTimeout(() => {
        console.log(`Timeout → source ${index + 1}`);
        index++;
        tryNext();
      }, 7000); // 7 sec max par source

      frame.onload = frame.onreadystatechange = () => {
        if (frame.readyState === 'complete' || frame.contentDocument?.body?.innerHTML?.length > 100) {
          clearTimeout(timeout);
          loader.style.display = 'none';
        }
      };
    }

    player.classList.add('active');
    document.body.style.overflow = 'hidden';
    tryNext();
  }

  function closePlayer() {
    const player = document.getElementById('player');
    const frame = document.getElementById('frame');
    player.classList.remove('active');
    frame.src = '';
    document.body.style.overflow = 'auto';
    document.querySelectorAll('.card').forEach(c => c.style.display = 'block');
  }

  function search(q) {
    const cards = document.querySelectorAll('.card');
    cards.forEach(c => {
      const title = c.querySelector('.title').textContent.toLowerCase();
      c.style.display = title.includes(q.toLowerCase()) ? 'block' : 'none';
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.card').forEach(card => {
      card.addEventListener('click', () => {
        const imdb = card.dataset.imdb;
        const title = card.dataset.title;
        play(imdb, title);
      });
    });
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') closePlayer();
    });
  });
</script>
</body>
</html>
